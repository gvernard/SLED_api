{% load static %}

{% if stream %}
<table class="jb-activity">
  <tbody>
    {% for action in stream %}
    <tr class="sled-action-row">
      <!-- <td><a href="/sled_actions/view/{{ action.pk }}"><img src="{% static 'icons/box-arrow-up-right.svg' %}" alt="link"></a></td> -->
      <td>{{ action.timestamp|timesince }} ago</td>
      <td>{{ action.actor }}</td>
      <td>{{ action.verb }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<div style="display:none">
  {% for action in stream %}
  <div id="tooltip-{{ forloop.counter0 }}">
    <table>
      <!-- <tr> -->
      <!-- 	<td>Actor: {{ action.actor }} ({{ action.actor.first_name }} {{ action.actor.last_name }})</td> -->
      <!-- 	<td>Time: {{ action.timestamp }}</td> -->
      <!-- 	<td>Type: {{ action.data.action_type }}</td> -->
      <!-- </tr> -->
      {% if action.data.action_type == "Add" %}
      <tr>
	<td colspan="3">
	  <a href="{% url 'lenses:lens-query' %}?ids={{ action.data.object_ids|join:','}}" target="_blank">{{ action.data.object_ids|length }} new {{ action.data.object_type }}</a>
	  were added by user
	  <a href="{{ action.actor.get_absolute_url }}" target="_blank">{{ action.actor }}</a>
	  at <em>{{ action.timestamp }}</em>
	</td>
      </tr>
      {% elif action.data.action_type == "AddData" %}
      <tr>
	<td colspan="3">{{ action.data.object_ids|length }} new {{ action.data.object_type }} were added by user <b>{{ action.actor }}</b> at {{ action.timestamp }}</td>
      </tr>
      {% elif action.data.action_type == "UpdateSelf" %}
      object_type (SledGroup,Collection)
      fields (json, dirty-field)
      {% elif action.data.action_type == "Update" %}
      object_type
      object_ids
      {% elif action.data.action_type == "DeleteObject" %}
      object_type
      object_ids (which are actually just names)
      {% elif action.data.action_type == "RemovedFromGroup" %}
      NONE
      {% elif action.data.action_type == "AddedToGroup" %}
      NONE
      {% elif action.data.action_type == "LeftGroup" %}
      NONE
      {% elif action.data.action_type == "RemovedFromCollection" %}
      object_type
      object_ids
      {% elif action.data.action_type == "AddedToCollection" %}
      object_type
      object_ids
      {% elif action.data.action_type == "MadePublic" %}
      object_type
      object_ids
      {% elif action.data.action_type == "MadePublicGroup" %}
      object_type
      object_ids
      {% elif action.data.action_type == "RevokeAccess" %}
      object_type
      object_ids
      {% elif action.data.action_type == "GiveAccess" %}
      object_type
      object_ids
      {% elif action.data.action_type == "CedeOwnershipSelf" %}
      NONE
      {% elif action.data.action_type == "CedeOwnership" %}
      object_type
      object_ids
      {% endif %}
    </table>            
  </div>
  {% endfor %}
</div>



<!-- <link rel="stylesheet" href="//code.jquery.com/ui/1.13.1/themes/base/jquery-ui.css"> -->
<!-- <script src="https://code.jquery.com/ui/1.13.1/jquery-ui.js"></script> -->



<link rel="stylesheet" type="text/css" href="{% static 'css/vendors/tooltipster.bundle.min.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'css/vendors/tooltipster-sideTip-shadow.min.css' %}" />
<script type="text/javascript" src="{% static 'js/tooltipster.bundle.min.js' %}"></script>
    
<script>
  $('.sled-action-row').each(function(index){
      var mycontent = $("#tooltip-"+String(index)).html();
      $(this).tooltipster({
	  theme: 'tooltipster-shadow',
	  interactive: true,
	  contentAsHTML: true,
	  content: mycontent
      });
  });
</script>

{% else %}
<p class="jb-homepage-activity">No activity to display</p>
{% endif %}
