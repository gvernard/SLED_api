{% extends 'master_header.html' %}
{% load static %}


{% block content %}

<div class="jb-container">
  <h1 class="jb-heading-1">Update {{ plural }}</h1>

  <div class="jb-table-no-lines">

    <form id="formset" formset-prefix="{{ data_formset.prefix }}" method="POST" enctype="multipart/form-data">
      <div>
        {% csrf_token %}
        {{ data_formset.management_form }}
        {{ data_formset.non_form_errors }}
	<input type="hidden" name="obj_type" value="{{ model }}">
	
        <table id="sled-data-table">
          {% for form in data_formset.forms %}
          <tr>
            <td>

              <div class="sled-row-content">
                <table>
                  <tr>
                    <td>
                      <h3 class="sled-data-counter">
			{{ forloop.counter }}: 
			<a href="{{ form.instance.lens.get_absolute_url }}">{{ form.instance.lens }}</a> - 
			{% if model == 'Imaging' or model == 'Catalogue' %}
			{{ form.instance.instrument }} {{ form.instance.band }} band
			{% else %}
			{{ form.instance.instrument }}
			{% endif %}
		      </h3>
                    </td>
                    <td class="sled-delete-button" style="float:right;"></td>
                  </tr>
                </table>

                {{ form.non_field_errors }}
                {{ form.id }}

                <table class="jb-update-data">
                  <tr>
                    <!-- First column -->
                    <td>
                      <div>
                        <table>
                          <tr>
                            <td>{{ form.date_taken.errors }}</td>
                            <td>{{ form.date_taken.label_tag }}</td>
                            <td>{{ form.date_taken }}</td>
                          </tr>
			  {% if form.future %}
                          <tr>
                            <td>{{ form.future.errors }}</td>
                            <td>{{ form.future.label_tag }}</td>
                            <td>{{ form.future }}</td>
                          </tr>
			  {% endif %}
                          <tr>
                            <td>{{ form.info.errors }}</td>
                            <td>{{ form.info.label_tag }}</td>
                            <td>{{ form.info }}</td>
                          </tr>

			  {% if model == 'Imaging' %}
                          <tr>
                            <td>{{ form.exposure_time.errors }}</td>
                            <td>{{ form.exposure_time.label_tag }}</td>
                            <td>{{ form.exposure_time }}</td>
			  </tr>
                          <tr>
                            <td>{{ form.pixel_size.errors }}</td>
                            <td>{{ form.pixel_size.label_tag }}</td>
                            <td>{{ form.pixel_size }}</td>
			  </tr>
			  {% elif model == 'Spectrum' %}
                          <tr>
                            <td>{{ form.exposure_time.errors }}</td>
                            <td>{{ form.exposure_time.label_tag }}</td>
                            <td>{{ form.exposure_time }}</td>
			  </tr>
                          <tr>
                            <td>{{ form.lambda_min.errors }}</td>
                            <td>{{ form.lambda_min.label_tag }}</td>
                            <td>{{ form.lambda_min }}</td>
			  </tr>
                          <tr>
                            <td>{{ form.lambda_max.errors }}</td>
                            <td>{{ form.lambda_max.label_tag }}</td>
                            <td>{{ form.lambda_max }}</td>
			  </tr>
                          <tr>
                            <td>{{ form.resolution.errors }}</td>
                            <td>{{ form.resolution.label_tag }}</td>
                            <td>{{ form.resolution }}</td>
			  </tr>
			  {% elif model == 'Catalogue' %}
                          <tr>
                            <td>{{ form.radet.errors }}</td>
                            <td>{{ form.radet.label_tag }}</td>
                            <td>{{ form.radet }}</td>
			  </tr>
                          <tr>
                            <td>{{ form.decdet.errors }}</td>
                            <td>{{ form.decdet.label_tag }}</td>
                            <td>{{ form.decdet }}</td>
			  </tr>
			  <tr>
                            <td>{{ form.mag.errors }}</td>
                            <td>{{ form.mag.label_tag }}</td>
                            <td>{{ form.mag }}</td>
			  </tr>
			  <tr>
                            <td>{{ form.Dmag.errors }}</td>
                            <td>{{ form.Dmag.label_tag }}</td>
                            <td>{{ form.Dmag }}</td>
			  </tr>
			  <tr>
                            <td>{{ form.distance.errors }}</td>
                            <td>{{ form.distance.label_tag }}</td>
                            <td>{{ form.distance }}</td>
			  </tr>
			  {% else %}
			  <tr>
			    <td>Unknown data type</td>
			  </tr>
			  {% endif %}
                        </table>
                      </div>
                    </td>


                    <!-- Second column -->
                    <td>
		      {% if model == 'Imaging' or model == 'Spectrum' %}
                      <div>
                        <table class="jb-paragraph-2">
			  <tr>
			    <td colspan="1" style="text-align:center">
                              {% if form.instance.image %}
                              <img class="sled-mugshot-image" src="{{ form.instance.image.url }}" alt="Image">
                              {% else %}
                              <img class="sled-mugshot-image" src="">
                              {% endif %}
			    </td>
			  </tr>
                          <tr>
                            <td style="text-align:center">
			      {{ form.image.errors }}
                              {{ form.image }}
			    </td>
                          </tr>
                        </table>
                      </div>
		      {% endif %}
                    </td>

                  </tr>
                </table>
              </div>

            </td>
          </tr>
          {% endfor %}
        </table>

      </div>



      <div>
        <button type="submit" class="jb-submit-button-1">Update</button>
      </div>
    </form>
  </div>
</div>
{% endblock content %}




{% block extrascripts %}
<script type="text/javascript">
  $(document).ready(function() {
    function readURL(input, $img) {
      if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) {
          $img.attr('src', e.target.result);
        }
        reader.readAsDataURL(input.files[0]);
      }
    }
    $(document).on("change", "input[name*='image']", function() {
      var $img = $(this).parent().parent().parent().find('img');
      readURL(this, $img);
    });
  });
</script>
{% endblock extrascripts %}
