{% extends 'master_header.html' %}
{% load static %}
{% load sled_group_extras %}
{% load activity_tags %}


{% block content %}
{% include "modal_container.html" %}


<div class="jb-container">
  <h1 class="jb-heading-1">{{ group.name }}</h1>
  <br></br>

  <!-- Div with some information about the group -->
  <div>
    <p> Description: {{ group.description }}</p>
    <p> Owner: {{ group.owner }}</p>
    <p> Number of members: {{ group.user_set.all|length }}</p>
    <p> Access to private objects: </p>
  </div>


  <!-- Div with different actions depending on if the user is owner, member, or neither -->
  <div>
    {% if user == group.owner %}

    <button type="button" id="delete-group" class="jb-submit-button-1" data-form-url="{% url 'sled_groups:group-delete' group.pk %}">
      <img src="{% static 'icons/trash.svg' %}" alt="trash">
      Delete
    </button>
    <button type="button" class="jb-submit-button-1" data-form-url="{% url 'sled_groups:group-update' group.pk %}">
      <img src="{% static 'icons/pencil.svg' %}" alt="pencil">
      Update
    </button>
    <button type="button" class="jb-submit-button-1" data-form-url="{% url 'sled_groups:group-cede-ownership' group.pk %}">
      <img src="{% static 'icons/trash.svg' %}" alt="trash">
      Cede ownership
    </button>
    <button type="button" class="jb-submit-button-1" data-form-url="{% url 'sled_groups:group-add-members' group.pk %}">
      <img src="{% static 'icons/person-plus-fill.svg' %}" alt="person plus">
      Add members
    </button>
    <button type="button" class="jb-submit-button-1" data-form-url="{% url 'sled_groups:group-remove-members' group.pk %}">
      <img src="{% static 'icons/person-dash-fill.svg' %}" alt="person minus">
      Remove members
    </button>

    {% elif request.user|has_group:group.name %}

    <button type="button" class="jb-submit-button-1" data-form-url="{% url 'sled_groups:group-leave' group.pk %}">
      <img src="{% static 'icons/pencil.svg' %}" alt="pencil">
      Leave group
    </button>

    {% else %}

    <button type="button" id="ask-to-join-group" class="jb-submit-button-1" data-form-url="{% url 'sled_groups:group-ask-to-join' group.id %}">
      Join
    </button>

    {% endif %}
  </div>




  <!-- List sensitive group details (group members, activity stream, access to objects, etc) -->
  {% if user == group.owner or request.user|has_group:group.name %}
  <div class="jb-activity">
    {% activity_stream 'target' group %}
    {% if stream %}
    <table>
      <tbody>
        {% for action in stream %}
        <tr>
          <td>{{ action.timestamp|timesince }} ago</td>
          <td>{{ action.actor }}</td>
          <td>{{ action.verb }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    No activity to display
    {% endif %}
  </div>


  <div>
    <h1 class="jb-heading-2">List of Group Members</h1>
    <table>
      <tr>
        <th>Name</th>
        <th>Affiliation</th>
      </tr>
      {% for user in group.getAllMembers %}
      <tr>
        <td>{{user.username}}</td>
        <td>{{user.affiliation}}</td>
      </tr>
      {% endfor %}
    </table>
  </div>


  <h1 class="jb-heading-2">List group access to various object types and collections</h1>
  {% endif %}
  <br></br>
  <br></br>
</div>


{% endblock content %}


{% block extrastyles %}
<!-- THe line below is to style the drop down auto-complete text input -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
{% endblock extrastyles %}


{% block extrascripts %}
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script type="text/javascript" src="{% static 'lenses/js/autocomplete.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha384-VHvPCCyXqtD5DqJeNxl2dtTyhF78xXNXdkwX1CZeRusQfRKp+tA7hAShOK/B/fQ2" crossorigin="anonymous"></script>
<script src="{% static 'js/jquery.bootstrap.modal.forms.js' %}"></script>
<script type="text/javascript">
  $(document).ready(function() {

    // Modals
    $('#delete-group').modalForm({
      formURL: $('#delete-group').data("form-url"),
      modalID: "#id-modal",
      isDeleteForm: true
    });

    $(".sled-modal").each(function() {
      $(this).modalForm({
        formURL: $(this).data("form-url"),
        modalID: "#id-modal"
      });
    });

    $("#ask-to-join-group").modalForm({
      formURL: $("#ask-to-join-group").data("form-url"),
      modalID: "#id-modal"
    });
  });
</script>
{% endblock extrascripts %}
