{% extends 'master_header.html' %}
{% load static %}


{% block content %}

<!-- Hidden elements needed for the user and group autocomplete -->
<input type="hidden" id="Urlusers" data-url="{% url 'api:users-view' %}" />
<input type="hidden" id="Urlgroups" data-url="{% url 'api:groups-view' %}" />

<!-- Modal divs -->
<div class="modal fade" id="id-modal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content"></div>
  </div>
</div>
{% if  group.owner != user %}
<div class="modal fade" tabindex="-1" role="dialog" id="id-modal-leave">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
	<h5 class="modal-title">Are you sure you want to leave this group?</h5>
	<button type="button" class="close" data-dismiss="modal" aria-label="Close">
	  <span aria-hidden="true">&times;</span>
	</button>
      </div>
      <div class="modal-footer">
	<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
	<form id="dum-form" method="POST">
	  {% csrf_token %}
	</form>
	<button type="submit" form="dum-form" class="btn btn-danger">Leave</button>
      </div>
    </div>
  </div>
</div>
{% endif %}




<h1>{{ group.name }}</h1>

<hr>

<!-- Div with some information about the group and different actions for users or the owner -->
<div>
  <p> Description: {{ group.description }}</p>
  <p> Owner: {{ group.owner }}</p>

  {% if  group.owner == user %}
  <button type="button" id="delete-group" class="btn btn-sm btn-danger" data-form-url="{% url 'sled_groups:group-delete' group.pk %}">
    <img src="{% static 'icons/trash.svg' %}" alt="trash">
    Delete
  </button>
  <button type="button" id="update-group" class="btn btn-sm btn-primary" data-form-url="{% url 'sled_groups:group-update' group.pk %}">
    <img src="{% static 'icons/pencil.svg' %}" alt="pencil">
    Update
  </button>
  <button type="button" id="cede-ownership" class="btn btn-sm btn-danger" data-form-url="{% url 'sled_groups:group-cede-ownership' %}">
    <img src="{% static 'icons/trash.svg' %}" alt="trash">
    Cede ownership
  </button>
  <button type="button" class="sled-add-remove-members btn btn-sm btn-primary" data-form-url="{% url 'sled_groups:group-add-remove-members' %}?mode=add">
    <img src="{% static 'icons/person-plus-fill.svg' %}" alt="person plus">
    Add members
  </button>
  <button type="button" class="sled-add-remove-members btn btn-sm btn-primary" data-form-url="{% url 'sled_groups:group-add-remove-members' %}?mode=remove">
    <img src="{% static 'icons/person-dash-fill.svg' %}" alt="person minus">
    Remove members
  </button>

  {% else %}
  <button type="button" class="btn btn-sm btn-primary" data-toggle="modal" data-target="#id-modal-leave">
    <img src="{% static 'icons/pencil.svg' %}" alt="pencil">
    Leave group
  </button>
  {% endif %}
</div>

<hr>

<!-- List of users in the group -->
<div>
  <p>List of group members</p>
  <table>
    <tr>
      <th>Name</th>
      <th>Affiliation</th>
    </tr>
    {% for user in group.getAllMembers %}
    <tr>
      <td>{{user.username}}</td>
      <td>{{user.affiliation}}</td>
    </tr>
    {% endfor %}
  </table>
</div>

<hr>

{% endblock content %}


{% block extrastyles %}
<!-- THe line below is to style the drop down auto-complete text input -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
{% endblock extrastyles %}


{% block extrascripts %}
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script type="text/javascript" src="{% static 'lenses/js/autocomplete.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js" integrity="sha384-VHvPCCyXqtD5DqJeNxl2dtTyhF78xXNXdkwX1CZeRusQfRKp+tA7hAShOK/B/fQ2" crossorigin="anonymous"></script>
<script src="{% static 'js/jquery.bootstrap.modal.forms.js' %}"></script>
<script type="text/javascript">
  $(document).ready(function(){

      // Modals
      $('#delete-group').modalForm({
 	  formURL: $('#delete-group').data("form-url"),
 	  modalID: "#id-modal",
 	  isDeleteForm: true
      });
      
      $("#update-group").modalForm({
          formURL: $("#update-group").data("form-url"),
 	  modalID: "#id-modal"
      });

      $("#cede-ownership").click(function(){
	  var dum = window.location.href.split('/');
	  var get_str = '?group_id=' + dum[dum.length-1];
	  var new_form_url = $("#cede-ownership").data("form-url") + get_str;
	  $(this).modalFormTrigger({
	      formURL: new_form_url,
 	      modalID: "#id-modal"
	  });
      });

      $(".sled-add-remove-members").click(function(){
	  var dum = window.location.href.split('/');
	  var get_str = '&group_id=' + dum[dum.length-1];
	  var new_form_url = $(this).data("form-url") + get_str;
	  $(this).modalFormTrigger({
	      formURL: new_form_url,
 	      modalID: "#id-modal"
	  });
      });
      
  });
</script>
{% endblock extrascripts %}
